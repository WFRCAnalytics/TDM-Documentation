---
title: Traffic Analysis Zone Updates
warning: false
message: false
echo: false
---

## Changes to TAZ Geometry and Attributes

Major changes were made to the version 9 Traffic Analysis Zones (TAZ), including:

 - Internal TAZ were split to increase the modelâ€™s geographic resolution. 
 - TAZ boundaries were modified to better align with underlying land uses and planning boundaries.
 - The geographic coverage area was expanded to encompass the entire county for Davis, Salt Lake, and Utah counties. Weber County was expanded up to the ridgeline of the east canyon/mountain areas of the WFRC planning domain but does not include the Ogden Valley area. Box Elder was expanded to encompass up to the ridgeline of the east canyon/mountain areas of the WFRC planning domain.

@fig-expanded-areas and @fig-taz-compare-map show the expanded geographic area and the difference in TAZ boundaries between version 9 and version 8.

![Version 9 Expanded Geographic Area](_pictures/expanded-area.png){#fig-expanded-areas width=40%}

```{ojs}
//|label: fig-taz-compare-map
//|fig-cap: TAZ Geography Comparison Map
//|echo: false

mapTaz = {

  let container = DOM.element('div', { style: `width:${width}px;height:${width/1.6}px` });
  yield container;
  
  let map = L.map(container).setView([40.7608, -111.8910], 8.25);

  let greyLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  let lcolors = ['#0000FF'    ,'red'   ]
  let llabels = ['v8.3.2 TAZ' ,'v9.0.0 TAZ'];

  let lyrTAZOld = L.geoJson(geojsonTazOld, { weight: 3.00, color: lcolors[0], fillOpacity: 0}).addTo(map);
  let lyrTAZNew = L.geoJson(geojsonTazNew, { weight: 1.50, color: lcolors[1], fillOpacity: 0}).addTo(map);

  var legend = L.control({position: 'bottomleft'});
    legend.onAdd = function (map) {
      var div = L.DomUtil.create('div', 'legend');
      div.innerHTML = '';
      for (var i = 0; i < llabels.length; i++) {
        div.innerHTML += '<i style="background:' + lcolors[i] + '">&nbsp;</i> ' + llabels[i] + '<br/>';
      }

      // Add CSS style for the background color
      div.style.backgroundColor = 'lightgray';
      div.style.padding = '10px';
      
      return div;
    };
    legend.addTo(map);
}
```

The changes resulted in the addition of 688 internal TAZ. The new internal TAZID range for each county was updated to account for the new zone configuration. A buffer of 54 zones was inserted after the last internal TAZ to allow for future internal TAZ expansion within the max used-zone value. 

::: {.grid}
::: {.g-col-2}
:::
::: {.g-col-8}
```{python}
#| label: tbl-internal-taz-comparison
#| tbl-cap: Internal TAZ Comparison
import pandas as pd
from IPython.display import Markdown
from tabulate import tabulate
table = {
    'County': ['Box Elder', 'Weber', 'Davis', 'Salt Lake', 'Utah', 'Total', 'Unused Zones'],
    'v9c': [153, 428, 324, 1311, 1330, 3546, 54],
    'v8c': [135, 280, 231, 1127, 1085, 2858, 0],
    'Change': [18, 148, 93, 184, 245, 688, 54],
    'v9t': [1-153, 154-581, 582-905, 906-2216, 2217-3546, 1-3546, 3547-3600],
    'v8t': [1-135, 141-420, 424-654, 655-1781, 1789-2873, 1-2873, 'NA']
}
headers = ['County','v9 Count','v8 Count','Change', 'v9 TAZID Range', 'v8 TAZID Range']
Markdown(tabulate(table, 
  headers = headers,
  tablefmt="pipe", 
  colalign=("left",)*len(headers), 
  showindex=False)
)
```
:::
:::

The locations and numbering of the external TAZ gateways were revised to reflect the changes of the expanded internal TAZ coverage area and new internal numbering. The external TAZ numbering was grouped and placed after the internal TAZ and a unused zone buffer. For reference, version 8 external TAZ were ordered by county and shuffled in the internal TAZ range, (e.g. Box Elder externals TAZ following after the Box Elder internal TAZ, Weber external TAZ following the Weber internal TAZ, etc.). The external TAZ changes resulted in the addition of 6 external TAZ. (See [Changes to External Location and Numbering](https://wfrc.org/wftdm-docs/v9x/v900/whats-new/14-networks.html#changes-to-external-location-and-numbering) for more information on external zones.)

::: {.grid}
::: {.g-col-2}
:::
::: {.g-col-8}
```{python}
#| label: tbl-external-taz-comparison
#| tbl-cap: External TAZ Comparison
import pandas as pd
from IPython.display import Markdown
from tabulate import tabulate
table = {
    'County': ['Box Elder', 'Weber', 'Davis', 'Salt Lake', 'Utah', 'Total'],
    'v9c': [6, 3, 0, 6, 14, 29],
    'v8c': [5, 3, 0, 7, 8, 23],
    'Change': [1, 0, 0, -1, 6, 6],
    'v9t': ['3601-3606','3607-3609','','3610-3615','3616-3629','3601-3629'],
    'v8t':['136-140', '421-423', '', '1782-1788', '2874-2881', '137-140, 421-423, 1782-1788, 2874-2881']
}
headers = ['County','v9 Count','v8 Count','Change', 'v9 TAZID Range', 'v8 TAZID Range']
Markdown(tabulate(table, 
  headers = headers,
  tablefmt="pipe", 
  colalign=("left",)*len(headers), 
  showindex=False)
)
```
:::
:::

In addition, the following changes were made to the TAZ shapefile:

 - The TAZ UTM NAD83 projection was fixed to use the standard for Utah rather than the ArcGIS default.
 - All TAZ boundaries were realigned to county boundaries from the most recent UGRC county dataset.
 - All internal TAZ topology was checked and corrected to exclude slivers, gaps, and overlaps.
 - External zone polygons (i.e. the arbitrary polygons representing the external zones) were removed in the TAZ shapefile.
 - **PRKCSTPERM** and **PRKCSTTEMP** fields were updated (see [Parking Costs](https://wfrc.org/wftdm-docs/v9x/v900/whats-new/5-baseyear.html#parking-costs) for additional information)
 - Large, medium, and small district definitions were updated. There are now 26 large districts, 73 medium districts, and 110 small districts. Medium districts still nest within large districts. Small districts were defined based on city area definitions and do not nest within medium districts. All districts were renamed and no longer include commas in the text string.
 - **CITY**, **COUNTY**, and **EXTERNAL** fields were removed. All model scripts referencing **CITY** and **COUNTY** were updated to use **CITY_FIPS** and **CO_FIPS**. 
 - A **REMM** field was added to indicate which TAZs are included in the Real Estate Market Model (REMM), as shown in @fig-taz-remm-space. A value of `1` indicates that the TAZ is part of the REMM area.

 ```{ojs}
//|echo: false
// setup mapping and layers
L = require('leaflet@1.2.0')
html`<link href='${resolve('leaflet@1.2.0/dist/leaflet.css')}' rel='stylesheet' />`

geojsonTazOld    = FileAttachment("data/tazOld.geojson"   ).json()
geojsonTazNew    = FileAttachment("data/tazNew.geojson"   ).json()
```

```{ojs}
//|label: fig-taz-remm-space
//|fig-cap: TAZ REMM Space
//|echo: false

mapTazRemmSpace = {

  let container = DOM.element('div', { style: `width:${width}px;height:${width/1.6}px` });
  yield container;
  
  let map = L.map(container).setView([40.7608, -111.8910], 8.25);

  let greyLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  let remmColors = ['#00887F'   ,'#BD0026'       ]
  let remmLabels = ['REMM Space','Non-REMM Space'];
  
  let lyrTAZNew = L.geoJson(geojsonTazNew, {
                            style: function(feature) {
                              var d = feature.properties.REMM;
                              return d==1 ? {color:remmColors[0], weight:1, opacity:0.95} :
                                     d==0 ? {color:remmColors[1], weight:1, opacity:0.95} : 
                                            {color:    '#000000', weight:1, opacity:0.95} ;
                            }
  }).addTo(map);
  
  var legend = L.control({position: 'bottomleft'});
  legend.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'legend');
    div.innerHTML = '';
    for (var i = 0; i < remmLabels.length; i++) {
      div.innerHTML += '<i style="background:' + remmColors[i] + '">&nbsp;</i> ' + remmLabels[i] + '<br/>';
    }

    // Add CSS style for the background color
    div.style.backgroundColor = 'lightgray';
    div.style.padding = '10px';
    
    return div;
  };
  legend.addTo(map);
}
```

### Changes to TAZ Parameters

The following TAZ-related parameters, located in the`0_GeneralParameters.block` file, were changed to reflect the version 9 TAZ updates. For comparison purposes, version 8 parameters are also presented.

**Used Zones**

::: {.grid}
::: {.g-col-3}
:::
::: {.g-col-6}
```{python}
#| label: tbl-updated-used-zones
#| tbl-cap: Updated Used Zones
import pandas as pd
from IPython.display import Markdown
from tabulate import tabulate

table = pd.read_csv('tables/1-genparams.csv')
table = table.loc[table['Table'] == 'UsedZones']
table = table[['Parameter', 'v9Value', 'v8Value','Notes']]

headers = ['Parameter', 'v9 Value', 'v8 Value', 'Notes']
Markdown(tabulate(table, 
  headers = headers,
  tablefmt="pipe", 
  colalign=("left",)*len(headers), 
  showindex=False)
)
```
:::
:::

**TAZ Ranges**

::: {.grid}
::: {.g-col-1}
:::
::: {.g-col-10}
```{python}
#| label: tbl-taz-ranges
#| tbl-cap: Renumbered TAZ Ranges
#| tbl-colwidths: [20,20,30,30]
import pandas as pd
import numpy as np
from IPython.display import Markdown
from tabulate import tabulate

table = pd.read_csv('tables/1-genparams.csv')
table = table.loc[table['Table'] == 'TAZ']
table = table[['Parameter', 'v9Value', 'v8Value','Notes']]

headers = ['Parameter', 'v9 Value', 'v8 Value','Notes']
Markdown(tabulate(table, 
  headers=headers, 
  tablefmt="pipe", 
  colalign=("left",)*len(headers), 
  showindex=False)
)
```
:::
:::

**College Zones**

Where noted, several colleges were effectively removed from the model in version 9. References to these schools are still in the code base but enrollment was set to zero.

::: {.grid}
::: {.g-col-1}
:::
::: {.g-col-10}
```{python}
#| label: tbl-college-renumber
#| tbl-cap: Renumbered College Zones
#| tbl-colwidths: [20,20,11,11,38]
table = pd.read_csv('tables/1-genparams.csv')
table = table.loc[table['Table'] == 'CollegeZones1']
table = table[['SubHeader','Parameter', 'v9Value', 'v8Value','Notes']]
table = table.rename(columns={'SubHeader':'Area'})
table = table.replace(np. nan,'',regex=True) 
headers = ['Area','Parameter', 'v9 Value', 'v8 Value','Notes']
Markdown(tabulate(table, 
  headers=headers, 
  tablefmt="pipe", 
  colalign=("left",)*len(headers), 
  showindex=False)
)
```
:::
:::

::: {.grid}
::: {.g-col-1}
:::
::: {.g-col-10}
```{python}
#| label: tbl-college-renumber-2
#| tbl-cap: Updated Colleges (Range)
#| tbl-colwidths: [15,40,45]
table = pd.read_csv('tables/1-genparams.csv')
table = table.loc[table['Table'] == 'CollegeZones2']
table = table[['Parameter', 'v9Value', 'v8Value']]
table.rename(columns = {'v9Value':'v9 Value', 'v8Value':'v8 Value'}, inplace=True)
headers = ['Parameter', 'v9 Value', 'v8 Value']
Markdown(tabulate(table, 
  headers=headers, 
  tablefmt="pipe", 
  colalign=("left",)*len(headers), 
  showindex=False)
)
```
:::
:::

**Zones with Off-line (Exogenous) Trip Tables**

::: {.grid}
::: {.g-col-3}
:::
::: {.g-col-6}
```{python}
#| label: tbl-offline-renumber
#| tbl-cap: Renumbered Off-line Trip Table Zones
table = pd.read_csv('tables/1-genparams.csv')
table = table.loc[table['Table'] == 'OfflineTripZones']
table = table[['Parameter', 'v9Value', 'v8Value']]
table.rename(columns = {'v9Value':'v9 Value', 'v8Value':'v8 Value'}, inplace=True)
headers = ['Parameter', 'v9 Value', 'v8 Value']
Markdown(tabulate(table, 
  headers=headers, 
  tablefmt="pipe", 
  colalign=("left",)*len(headers), 
  showindex=False)
)
```
:::
:::

**Special Generator Zones**

::: {.grid}
::: {.g-col-3}
:::
::: {.g-col-6}
```{python}
#| label: tbl-specgen-renumber
#| tbl-cap: Renumbered Special Generator Zones
table = pd.read_csv('tables/1-genparams.csv')
table = table.loc[table['Table'] == 'SpecialGeneratorZones']
table = table[['Parameter', 'v9Value', 'v8Value']]
table.rename(columns = {'v9Value':'v9 Value', 'v8Value':'v8 Value'}, inplace=True)
headers = ['Parameter', 'v9 Value', 'v8 Value']
Markdown(tabulate(table, 
  headers=headers, 
  tablefmt="pipe", 
  colalign=("left",)*len(headers), 
  showindex=False)
)
```
:::
:::

**Removed Parameters**

The following TAZ parameters were removed from the general parameters file as they were not being used in the WF TDM:

 - RegionRange
 - WFRCRange
 - MAGRange

### Changes to TAZ Input Folder

The following changes were made in the `1_Inputs\1_TAZ` folder:

 - Added `_Source` folder which includes the following shapefile datasets:
    - Cities shapefile
    - Counties shapefile
    - Environmental constraints shapefile (just the Wasatch Front model space)
    - Previous version 8.3.2 TAZ
 - Added `_ViewTAZDistricts` folder containing an ArcGIS Pro project with predefined symbology for viewing TAZ and district shapefiles.
 - In the `Districts` folder:
    - Updated the large, medium, and small district shapefiles based on the new TAZ delineations and district definitions.
    - Added new shapefiles representing the Wasatch Front subarea, the REMM area, and super districts.

