<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="WFRC / MAG">

<title>Documentation - Version 3.2.0 - What’s New?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../_pictures/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="https://wfrc.org" class="navbar-brand navbar-brand-logo">
    <img src="../../../_pictures/wf-logo-new-white-t.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target="">
 <span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-version-9.x" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Version 9.x</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-version-9.x">    
        <li>
    <a class="dropdown-item" href="../../../v9x/v900/index.html" rel="" target="">
 <span class="dropdown-text">Version 9.0.0</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-version-8.x" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Version 8.x</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-version-8.x">    
        <li>
    <a class="dropdown-item" href="../../../v8x/v832/index.html" rel="" target="">
 <span class="dropdown-text">Version 8.3.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v8x/v831/index.html" rel="" target="">
 <span class="dropdown-text">Version 8.3.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v8x/v830/index.html" rel="" target="">
 <span class="dropdown-text">Version 8.3.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v8x/v810/index.html" rel="" target="">
 <span class="dropdown-text">Version 8.1.0</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-past-versions" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Past Versions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-past-versions">    
        <li>
    <a class="dropdown-item" href="../../../v7x/v702/index.html" rel="" target="">
 <span class="dropdown-text">Version 7.0.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v7x/v701/index.html" rel="" target="">
 <span class="dropdown-text">Version 7.0.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v7x/v700/index.html" rel="" target="">
 <span class="dropdown-text">Version 7.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v6x/v610/index.html" rel="" target="">
 <span class="dropdown-text">Version 6.1.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v6x/v600/index.html" rel="" target="">
 <span class="dropdown-text">Version 6.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v5x/v500/index.html" rel="" target="">
 <span class="dropdown-text">Version 5.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v4x/v430/index.html" rel="" target="">
 <span class="dropdown-text">Version 4.3.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v4x/v420/index.html" rel="" target="">
 <span class="dropdown-text">Version 4.2.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v4x/v400/index.html" rel="" target="">
 <span class="dropdown-text">Version 4.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v3x/v320/index.html" rel="" target="">
 <span class="dropdown-text">Version 3.2.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v3x/v310/index.html" rel="" target="">
 <span class="dropdown-text">Version 3.1.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v3x/v300/index.html" rel="" target="">
 <span class="dropdown-text">Version 3.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v2x/v210/index.html" rel="" target="">
 <span class="dropdown-text">Version 2.1.0</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-testing" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Testing</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-testing">    
        <li>
    <a class="dropdown-item" href="../../../testing/jupyter-widgets.html" rel="" target="">
 <span class="dropdown-text">Visualization</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <a href="https://github.com/WFRCAnalytics/TDM-Documentation/tree/gh-pages" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Whats New?</li><li class="breadcrumb-item"><a href="../../../v3x/v320/whats-new/v32-intro.html">02/10/2004</a></li><li class="breadcrumb-item"><a href="../../../v3x/v320/whats-new/v32-mode-choice.html">Mode Choice</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/downloads.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Downloads</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Whats New?</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">02/10/2004</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/whats-new/v32-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/whats-new/v32-necessary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Why v3.2 was Necessary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/whats-new/v32-input-prep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Input Preparation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/whats-new/v32-mode-choice.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Mode Choice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/whats-new/v32-district-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">District Analysis Tool</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/whats-new/v32-hway-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Highway Analysis Tool</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v3x/v320/whats-new/v32-terms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Terms and Abbreviations</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#mode-choice" id="toc-mode-choice" class="nav-link active" data-scroll-target="#mode-choice">Mode Choice</a>
  <ul class="collapse">
  <li><a href="#improved-hbc-calibration-targets-and-distribution" id="toc-improved-hbc-calibration-targets-and-distribution" class="nav-link" data-scroll-target="#improved-hbc-calibration-targets-and-distribution">Improved HBC calibration targets and distribution</a></li>
  <li><a href="#improved-nhb-calibration-targets" id="toc-improved-nhb-calibration-targets" class="nav-link" data-scroll-target="#improved-nhb-calibration-targets">Improved NHB calibration targets</a></li>
  <li><a href="#improved-transit-walkdrive-accessegress-algorithm" id="toc-improved-transit-walkdrive-accessegress-algorithm" class="nav-link" data-scroll-target="#improved-transit-walkdrive-accessegress-algorithm">Improved Transit Walk/Drive Access/Egress algorithm</a></li>
  <li><a href="#defined-a-method-for-modeling-brt" id="toc-defined-a-method-for-modeling-brt" class="nav-link" data-scroll-target="#defined-a-method-for-modeling-brt">Defined a method for modeling BRT</a></li>
  <li><a href="#revised-the-background-transit-network-for-south-davis-county" id="toc-revised-the-background-transit-network-for-south-davis-county" class="nav-link" data-scroll-target="#revised-the-background-transit-network-for-south-davis-county">Revised the background transit network for South Davis County</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="v32-mode-choice.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Version 3.2.0 - What’s New?</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>WFRC / MAG </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">May 22, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="mode-choice" class="level2">
<h2 class="anchored" data-anchor-id="mode-choice">Mode Choice</h2>
<section id="improved-hbc-calibration-targets-and-distribution" class="level3">
<h3 class="anchored" data-anchor-id="improved-hbc-calibration-targets-and-distribution">Improved HBC calibration targets and distribution</h3>
<p>Researching the details for Commuter Rail forecasting revealed the 3.1 model had an inordinately high share of Home-Based College trips on transit. There were several contributing problems. First, the Nov.&nbsp;2002 on-board survey incorrectly categorized many trips. 15% of HBC trips were made by people over 30 years old. We believe most of these were likely work trips attracted to a college; they were thus reclassified. Another 10% were attracted to small colleges that we do not account for (cosmetology colleges, etc.). These were reclassified as HBO. New target values were computed from the changes.</p>
<p>In addition, the total number of HBC trips was low. Since the total light-rail trips to the U of U was known and calibrated to (by means of the light-rail alternative specific constant), but the total trips to the U of U was low, the result was an overly high share of HBC transit trips relative to auto trips. Daily HBC productions per student was raised from 0.7 to 1.0 to help correct this.</p>
<p>College distribution is based on the zipcode of the student’s reported address. However, many students report their parent’s address for mailings. Where the address is reasonably close to the college, the student probably lives at home; but where the address exceeds 30, 40, and even 50 miles; it becomes less likely that they actually live there, or that they make frequent trips to the college. In the case of the U of U, 1.5% of the HBC trips supposedly came from Weber County, which ranges from 35-50 miles away. To counter this, HBC productions were distributed on a distance gradient with 1.5 HBC productions/day for student addresses within 1 mile of campus, changing linearly to 0.1 HBC productions/day for student addresses exceeding 40 miles. Future year distributions also have an adjustment for high-growth zones that are within range of the college.</p>
</section>
<section id="improved-nhb-calibration-targets" class="level3">
<h3 class="anchored" data-anchor-id="improved-nhb-calibration-targets">Improved NHB calibration targets</h3>
<p>The Non-home-based purpose was also unusually high in the 2002 on-board survey. Again, suspect surveys may be to blame. NHB trips exceeding 10 miles were excluded from the survey. NHB trips that involved driving were excluded unless the CBD was a trip-end.</p>
</section>
<section id="improved-transit-walkdrive-accessegress-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="improved-transit-walkdrive-accessegress-algorithm">Improved Transit Walk/Drive Access/Egress algorithm</h3>
<p>Version 3.1 included a grid of walk access support links that were manually input for the SL CBD. This grid made it possible for many “transit trips” to walk along the grid without actually taking transit. The result was an under-estimate of the number of CBD circulation trips taken by transit. The manual links were removed, and improved logic was added to the auto-generation of these support links.</p>
<p>The on-board survey was also assigned to the transit network at FTA’s recommendation to reveal surveyed trips that could not be assigned to the correct path type. The result lead to increasing the park-n-ride travel sheds, adding new PNR lots, and adjusting the path favoring weights.</p>
</section>
<section id="defined-a-method-for-modeling-brt" class="level3">
<h3 class="anchored" data-anchor-id="defined-a-method-for-modeling-brt">Defined a method for modeling BRT</h3>
<p>We have wrestled for a means of defining a Bus Rapid-Transit line for modeling purposes. BRT is a broad category that could range from little more than a bus with limited stops all the way up to a light-rail-like alignment with full stations. There is no observed “BRT mode” from which to select an alternative specific constant, so we developed a checklist to help reveal the most appropriate modeling definition. Basically, if the proposal appears to be very light-rail-like, we are recommending it be coded as a slower-than-normal LRT (mode 7). If it shares more traits with a bus, a faster-than-normal bus (mode 4) seems appropriate. If it is a hybrid, model it both ways and assume ridership in the middle. A “how-to” memo defines the presently supported method.</p>
</section>
<section id="revised-the-background-transit-network-for-south-davis-county" class="level3">
<h3 class="anchored" data-anchor-id="revised-the-background-transit-network-for-south-davis-county">Revised the background transit network for South Davis County</h3>
<p>Before BRT was proposed in South Davis, we assumed a simple increase in the frequency of existing South Davis buses to obtain a future network. After BRT was adopted in the LRP, we neglected to review the whole system for redundancy. We now have only the BRT, and Commuter Rail (CRT) serving SL CBD from South Davis, with supporting feeder routes. Before we had all of these and a host of high-frequency local buses, which was inordinately high service relative to the rest of the region. BRT is defined at 15,15 headways and CRT is 20,60. This should provide a good base from which to compare and develop alternatives for the South Davis transit study.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left"><a href="https://wfrc.org"><img src="https://wfrc.org/wp-content/uploads/2021/11/logo.jpg" class="img-fluid" alt="WFRC" width="150"></a> <a href="https://mountainland.org/"><img src="https://mountainland.org/static/media/logo/svg/MAG_Logo_Horz_NoTag.svg" class="img-fluid" alt="MAG" width="65"></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Built using <a href="https://quarto.org">Quarto</a></div>
  </div>
</footer>



</body></html>