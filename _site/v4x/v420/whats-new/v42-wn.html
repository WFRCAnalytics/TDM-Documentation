<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="WFRC / MAG">

<title>Documentation - Version 4.2.0 - What’s New?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../_pictures/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="https://wfrc.org" class="navbar-brand navbar-brand-logo">
    <img src="../../../_pictures/wf-logo-new-white-t.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target="">
 <span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-version-9.x" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Version 9.x</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-version-9.x">    
        <li>
    <a class="dropdown-item" href="../../../v9x/v900/index.html" rel="" target="">
 <span class="dropdown-text">Version 9.0.0</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-version-8.x" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Version 8.x</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-version-8.x">    
        <li>
    <a class="dropdown-item" href="../../../v8x/v832/index.html" rel="" target="">
 <span class="dropdown-text">Version 8.3.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v8x/v831/index.html" rel="" target="">
 <span class="dropdown-text">Version 8.3.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v8x/v830/index.html" rel="" target="">
 <span class="dropdown-text">Version 8.3.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v8x/v810/index.html" rel="" target="">
 <span class="dropdown-text">Version 8.1.0</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-past-versions" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Past Versions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-past-versions">    
        <li>
    <a class="dropdown-item" href="../../../v7x/v702/index.html" rel="" target="">
 <span class="dropdown-text">Version 7.0.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v7x/v701/index.html" rel="" target="">
 <span class="dropdown-text">Version 7.0.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v7x/v700/index.html" rel="" target="">
 <span class="dropdown-text">Version 7.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v6x/v610/index.html" rel="" target="">
 <span class="dropdown-text">Version 6.1.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v6x/v600/index.html" rel="" target="">
 <span class="dropdown-text">Version 6.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v5x/v500/index.html" rel="" target="">
 <span class="dropdown-text">Version 5.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v4x/v430/index.html" rel="" target="">
 <span class="dropdown-text">Version 4.3.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v4x/v420/index.html" rel="" target="">
 <span class="dropdown-text">Version 4.2.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v4x/v400/index.html" rel="" target="">
 <span class="dropdown-text">Version 4.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v3x/v320/index.html" rel="" target="">
 <span class="dropdown-text">Version 3.2.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v3x/v310/index.html" rel="" target="">
 <span class="dropdown-text">Version 3.1.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v3x/v300/index.html" rel="" target="">
 <span class="dropdown-text">Version 3.0.0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../v2x/v210/index.html" rel="" target="">
 <span class="dropdown-text">Version 2.1.0</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-testing" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Testing</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-testing">    
        <li>
    <a class="dropdown-item" href="../../../testing/jupyter-widgets.html" rel="" target="">
 <span class="dropdown-text">Visualization</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <a href="https://github.com/WFRCAnalytics/TDM-Documentation/tree/gh-pages" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Whats New?</li><li class="breadcrumb-item"><a href="../../../v4x/v420/whats-new/v42-intro.html">08/30/2004</a></li><li class="breadcrumb-item"><a href="../../../v4x/v420/whats-new/v42-wn.html">What’s New Summary</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/downloads.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Downloads</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Whats New?</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">08/30/2004</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/whats-new/v42-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/whats-new/v42-when.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">When to Use Improvements</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/whats-new/v42-necessary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Why v4.0 and v4.1 were Necessary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/whats-new/v42-wn.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">What’s New Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/whats-new/v42-new-features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">New Features</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/whats-new/v42-improvements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Development Plans</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../v4x/v420/whats-new/v42-terms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Terms and Abbreviations</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#short-trip-vs.-long-trip-improved-path-choice-methodology." id="toc-short-trip-vs.-long-trip-improved-path-choice-methodology." class="nav-link active" data-scroll-target="#short-trip-vs.-long-trip-improved-path-choice-methodology.">Short trip vs.&nbsp;Long trip improved path choice methodology.</a></li>
  <li><a href="#specific-trip-table-for-the-cabellas-sporting-goods-retailer-in-lehi." id="toc-specific-trip-table-for-the-cabellas-sporting-goods-retailer-in-lehi." class="nav-link" data-scroll-target="#specific-trip-table-for-the-cabellas-sporting-goods-retailer-in-lehi.">Specific trip-table for the Cabella’s sporting goods retailer in Lehi.</a></li>
  <li><a href="#drive-to-transit-access-location-improved-a-4.0-feature" id="toc-drive-to-transit-access-location-improved-a-4.0-feature" class="nav-link" data-scroll-target="#drive-to-transit-access-location-improved-a-4.0-feature">Drive to transit access location improved (a 4.0 feature)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Version 4.2.0 - What’s New?</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>WFRC / MAG </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">June 6, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="short-trip-vs.-long-trip-improved-path-choice-methodology." class="level2">
<h2 class="anchored" data-anchor-id="short-trip-vs.-long-trip-improved-path-choice-methodology.">Short trip vs.&nbsp;Long trip improved path choice methodology.</h2>
<p>The highway route choice methodology (assignment) was upgraded to assign long trips differently than short trips. Previous versions required all drivers to select a path to their destination by a combination of shortest distance and shortest time. To obtain calibration, path preference was weighted toward shortest distance. Such a setting can make the model insensitive to how certain trips would react to faster-but-longer opportunities. Other cities that have experienced issues like this have separated short trips from long trips and assigned long trips primarily by shortest time.</p>
<p>Short neighborhood-type trips tend to select the direct path between their origin and destination, though many will select an alternate if the preferred path is overly delayed. Many people on longer commute-type trips tend to study their options more and select a path likely to save them the most time, almost without regard to out-of-direction elements in the path.</p>
<p>In 4.2, trip lengths over 10 miles are considered long trips, and path choice is made by shortest time only. Shorter trip paths are weighted 65% on shortest distance, 35% on shortest time. Global calibration statistics are generally improved over 3.2, and a number of localized, network “hot-spots” are also improved. Since the path choice methodology is significantly different, volume projections on any given link may also be a fair amount different. A number of “dial settings” were changed to obtain calibration. Included are resetting geographic link penalties, functional type free-flow speeds, and volume-delay curves.</p>
</section>
<section id="specific-trip-table-for-the-cabellas-sporting-goods-retailer-in-lehi." class="level2">
<h2 class="anchored" data-anchor-id="specific-trip-table-for-the-cabellas-sporting-goods-retailer-in-lehi.">Specific trip-table for the Cabella’s sporting goods retailer in Lehi.</h2>
<p>There has been some concern regarding the impacts of Cabella’s being constructed in Lehi. It is said to be large enough and unique enough to draw trips from all over the region and even high numbers from outside the region. The regular gravity model will not model this well, considering it simply another retailer and sending trips to it primarily from within northern Utah County and southern SL County. In 4.2, its trip generation magnitude and distribution is created in an off-model spreadsheet, and the resulting trip table is fed into the model. This ensures that trips will be drawn from across the region, including Weber County and all major external stations. Thus it will have a more significant effect on roads even in these far-away places that it otherwise would have had.</p>
</section>
<section id="drive-to-transit-access-location-improved-a-4.0-feature" class="level2">
<h2 class="anchored" data-anchor-id="drive-to-transit-access-location-improved-a-4.0-feature">Drive to transit access location improved (a 4.0 feature)</h2>
<p>In 3.2, all PNR lots to be used in all years were coded as “higher draw” (15 minute) or “lower draw” (12 minute) ASCII files. Any zone within the max travel time was given access. We discovered this construction had numerous flaws. First, many trips in the survey drove more than 15 minutes to reach light rail (particularly from Utah Co). Next, a given zone may be within 12 minutes of as many as 8 light rail PNR lots, and the skim builder was set so as to encourage them to drive to the furthest most lot in order to minimize the time on transit. This was because when building rail-favored paths, we inadvertently avoided penalizing the drive portion of the path. Since the objective is to select a path that minimizes the weighted times, and since driving 5 miles is typically faster than riding 5-miles in the train, the path builder effectively told drivers to stay on the road as long as you can, defeating the reasons people drive to transit. This was not so much a problem with the number of trips that would access the mode as it was with selecting illogical locations to access the mode. The 4.0 model now weights the drive portion of mode-favoring, encouraging drivers to select the nearest lot.</p>
<p>Thus we found a 12-15 minute travel shed is too much and too little at the same time (some zones access far more PNR lots than they logically would select, and zones that would drive many miles to reach end-of-line stations don’t have the option). This manually supplied ASCII file method also requires accounting for future light-rail PNR lots even in the base year. These lots are not used by the MC model for LRT trips. They can be used for a bus trip, which is fine, but it makes the book-keeping difficult.</p>
<p>Version 4.0 abandons the manual method in favor of a network-based algorithm with the following steps:</p>
<ol type="1">
<li><p><em>ID lots on network:</em> Modeler identifies all potential PNR lots as node attributes on the master network by a modal hierarchy: A code 80 means that in runs where commuter rail stops at that node, drive access to commuter rail should be available. Drive access is then also available to all lesser modes if they happen to stop at that node. See the table below for codes.</p></li>
<li><p><em>Confirm that lot coincides with eligible routes for scenario:</em> Initial paths for the scenario network are built, and all transit stops are identified by node and mode. The result is a list of nodes where yes, the node was identified as an existing/potential PNR lot for that mode; and yes, that mode actually stops at that node.</p></li>
<li><p><em>Write PNR access code for most logical access point:</em> The nearest confirmed lots to a given zone are identified, and a TP+/Voyager format PNR record is recorded for that path. For commuter rail, only the nearest 2 lots are recorded. For light rail, BRT, and express bus, it’s the nearest 3.</p></li>
</ol>
<p>The results are much improved over the 3.2 method. Note that for light rail in SL County, even the western most zones can access the Sandy Trax line (not observable in 3.2), and only at lots along the same latitude. (See <a href="#fig-trax">Figure&nbsp;1</a>).</p>
<div id="fig-trax" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="_pictures/trax.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Improved light rail transit access.</figcaption>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left"><a href="https://wfrc.org"><img src="https://wfrc.org/wp-content/uploads/2021/11/logo.jpg" class="img-fluid" alt="WFRC" width="150"></a> <a href="https://mountainland.org/"><img src="https://mountainland.org/static/media/logo/svg/MAG_Logo_Horz_NoTag.svg" class="img-fluid" alt="MAG" width="65"></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Built using <a href="https://quarto.org">Quarto</a></div>
  </div>
</footer>



</body></html>